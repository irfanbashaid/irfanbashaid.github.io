<html>
    <head>
        <title>Election</title>
        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>
    </head>
    <body>
        <h2>Blockchain based voting</h2>
        <div class="class-1">
            <div class="class-2-pdr-25">
                <h5>Arun</h5>
                <h5>votes:<span id="Arun">0</span></h5>
                <button onclick="vote('Arun')" class="button-1">Vote</button>
            </div>
            <div class="class-2-pdl-25">
                <h5>Prasanth</h5>
                <h5>votes:<span id="Prasanth">0</span></h5>
                <button onclick="vote('Prasanth')" class="button-1">Vote</button>
            </div>
        </div>
        <div id="resultDiv">
            <button onclick="result()" class="button-2">Result</button>
        </div>
        <script>
            let web3Ins;
            let walletAddress;
            var contractIns;
            let jsonInterface = [
                {
                    "constant": false,
                    "inputs": [],
                    "name": "startElection",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "string",
                            "name": "candName",
                            "type": "string"
                        }
                    ],
                    "name": "voting",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "constant": true,
                    "inputs": [],
                    "name": "currentTime",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [],
                    "name": "result",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        }
                    ],
                    "name": "voteCount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                }
            ]
            let contractAddress = "0x2E6014027a78b17c948068a941Fcedcb4A50D0bd";
            init();
            async function init() {
                // console.log(window.web3);
                web3Ins = new window.Web3(window.ethereum);
                let res = await window.ethereum.enable();
                walletAddress = res[0];
                console.log(walletAddress);
                contractIns = new web3Ins.eth.Contract(jsonInterface, contractAddress);
                getVoteCount("Arun");
                getVoteCount("Prasanth");

            }
            function vote(candName) {
                contractIns.methods.voting(candName).send({from: walletAddress})
                .on('receipt', function(receipt){
                    console.log(receipt);
                    if(receipt && receipt.status && receipt.status==true ){
                        getVoteCount(candName);
                        alert("Successfully voted");
                    }
                    else {
                        alert("voting failed");
                    }
                })
            }
            function result() {
                contractIns.methods.result().call(function(error, result){
                    if(result){
                        alert(result);
                    }
                });
            }
            function getVoteCount(candName){
                contractIns.methods.voteCount(voteCount).call(function(error, result){
                    if(result){
                        document.getElementById(candName).innerText = result;
                    }
                });
            }
        </script>
        <style>
            body {
                text-align: center;
                font-size: 33px;
            }
            .class-1 {
                display: flex;
                margin: auto;
                justify-content: center;
            }
            .class-2-pdl-25 {
                padding-left: 25px;
            }
            .class-2-pdr-25 {
                padding-right: 25px;
            }
            .button-1 {
                background-color: blue;
                color: white;
                border-radius: 5px;
                font-size: 30px;
                padding: 12px;
            }
            .button-2 {
                background-color: green;
                color: black;
                border-radius: 5px;
                font-size: 30px;
                padding: 12px;
            }
            #resultDiv {
                padding-top: 33px;
            }
            
        </style>
    </body>

    
</html>
